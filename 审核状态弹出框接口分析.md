# å®¡æ ¸çŠ¶æ€å¼¹å‡ºæ¡†æ¥å£åˆ†æ

## ğŸ“‹ æ¦‚è¿°

åœ¨å€Ÿç”¨ç®¡ç†çš„"æˆ‘çš„é¢„çº¦"ç•Œé¢ä¸­ï¼Œç‚¹å‡»"å®¡æ ¸çŠ¶æ€"åˆ—æ—¶ä¼šå¼¹å‡ºå®¡æ ¸è¯¦æƒ…å¯¹è¯æ¡†ã€‚ç›®å‰è¯¥åŠŸèƒ½ä½¿ç”¨çš„æ˜¯å‰ç«¯æ¨¡æ‹Ÿæ•°æ®ï¼Œéœ€è¦è°ƒç”¨åç«¯æ¥å£è·å–çœŸå®çš„å®¡æ‰¹å†å²æ•°æ®ã€‚

## ğŸ” ç°çŠ¶åˆ†æ

### å‰ç«¯å®ç°åˆ†æ

**æ–‡ä»¶ä½ç½®**: `src/components/RoomBooking/Booking/MyBookings.vue`

```javascript
// å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®çš„å®ç°
function handleViewAuditDetail(row) {
  const base = bookingBaseInfo[row.id] || {}
  currentRecord.value = {
    reservationTitle: base.reservationName || row.reservationName,
    userName: base.applicant || row.applicantName,
    borrowPeriodText: base.reservationPeriod || row.reservationPeriod,
    borrowDesc: base.description || row.description,
    participants: base.participants ? base.participants.split(', ') : [],
    remark: base.remark || '',
    approvalStatus: base.approvalStatus || row.approvalStatus,
    approvalSteps: auditDetailData[row.id] || [], // æ¨¡æ‹Ÿæ•°æ®
  }
  auditDialogVisible.value = true
}
```

**å¼¹å‡ºæ¡†ç»„ä»¶**: `src/components/RoomBooking/Booking/AuditDetailDialog.vue`
- æ˜¾ç¤ºé¢„çº¦åŸºæœ¬ä¿¡æ¯å’Œå®¡æ‰¹æ­¥éª¤
- å®¡æ‰¹æ­¥éª¤è¡¨æ ¼åŒ…å«ï¼šå®¡æ‰¹å±‚çº§ã€å®¡æ‰¹äººã€ç¡®è®¤å®¡æ‰¹äººã€å®¡æ‰¹æ—¶é—´ã€å®¡æ‰¹æ„è§

## âœ… å·²å­˜åœ¨çš„åç«¯æ¥å£

### 1. è·å–å®¡æ‰¹å†å²æ¥å£

**æ¥å£è·¯å¾„**: `GET /api/room-booking/approval-history/{bookingId}`

**æ§åˆ¶å™¨**: `RoomBookingApprovalController.java`
```java
@GetMapping("/approval-history/{bookingId}")
public ResponseEntity<List<ApprovalHistoryResponse>> getApprovalHistory(@PathVariable String bookingId)
```

**æœåŠ¡å®ç°**: `RoomBookingServiceImpl.java`
```java
@Override
public List<ApprovalHistoryResponse> getApprovalHistory(String bookingId)
```

## ğŸ“ æ¥å£è¯¦ç»†è§„æ ¼

### è¯·æ±‚å‚æ•°

| å‚æ•°å    | ç±»å‹   | ä½ç½® | å¿…å¡« | è¯´æ˜   |
|-----------|--------|------|------|--------|
| bookingId | String | Path | æ˜¯   | é¢„çº¦ID |

### è¯·æ±‚ç¤ºä¾‹

```bash
GET /api/room-booking/approval-history/booking123456
Authorization: Bearer {token}
```

### å“åº”å‚æ•°

**å“åº”æ ¼å¼**: `ResponseEntity<List<ApprovalHistoryResponse>>`

#### ApprovalHistoryResponse å­—æ®µè¯´æ˜

| å­—æ®µå           | ç±»å‹            | è¯´æ˜             |
|------------------|-----------------|------------------|
| id               | String          | å®¡æ‰¹è®°å½•ID       |
| approverName     | String          | å®¡æ‰¹äººå§“å       |
| approverType     | String          | å®¡æ‰¹äººç±»å‹       |
| approvalAction   | String          | å®¡æ‰¹åŠ¨ä½œ         |
| approvalComment  | String          | å®¡æ‰¹æ„è§         |
| approvalTime     | LocalDateTime   | å®¡æ‰¹æ—¶é—´         |
| approvalLevel    | Integer         | å®¡æ‰¹çº§åˆ«         |
| isFinalApproval  | Boolean         | æ˜¯å¦ä¸ºæœ€ç»ˆå®¡æ‰¹   |
| levelName        | String          | çº§åˆ«åç§°ï¼ˆå‰ç«¯æ˜¾ç¤ºç”¨ï¼‰ |
| approvers        | String[]        | å®¡æ‰¹äººåˆ—è¡¨ï¼ˆå‰ç«¯æ˜¾ç¤ºç”¨ï¼‰ |
| confirmedApprover| String          | ç¡®è®¤å®¡æ‰¹äººï¼ˆå‰ç«¯æ˜¾ç¤ºç”¨ï¼‰ |

### å“åº”ç¤ºä¾‹

```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": "approval001",
      "approverName": "å¼ ä¸‰",
      "approverType": "è‡ªé€‰å®¡æ‰¹äºº",
      "approvalAction": "APPROVED",
      "approvalComment": "åŒæ„ï¼šæ’è¯¾æ­£å¸¸ï¼Œæ— å¼‚è®®",
      "approvalTime": "2025-07-21T11:20:00",
      "approvalLevel": 1,
      "isFinalApproval": false,
      "levelName": "ä¸€çº§å®¡æ‰¹",
      "approvers": ["å¼ ä¸‰", "æå››"],
      "confirmedApprover": "å¼ ä¸‰"
    },
    {
      "id": "approval002",
      "approverName": "ç‹äº”",
      "approverType": "é¢„è®¾å®¡æ‰¹äºº",
      "approvalAction": "PENDING",
      "approvalComment": null,
      "approvalTime": null,
      "approvalLevel": 2,
      "isFinalApproval": true,
      "levelName": "äºŒçº§å®¡æ‰¹",
      "approvers": ["ç‹äº”"],
      "confirmedApprover": ""
    }
  ]
}
```

## ğŸ”§ å‰ç«¯é›†æˆæ–¹æ¡ˆ

### 1. API æœåŠ¡å®šä¹‰

åœ¨ `src/api/roomBookingManagement.js` ä¸­æ·»åŠ ï¼š

```javascript
/**
 * è·å–é¢„çº¦å®¡æ‰¹å†å²
 * @param {string} bookingId é¢„çº¦ID
 * @returns {Promise} å®¡æ‰¹å†å²æ•°æ®
 */
export function getApprovalHistory(bookingId) {
  return request({
    url: `/api/room-booking/approval-history/${bookingId}`,
    method: 'get'
  })
}
```

### 2. å‰ç«¯è°ƒç”¨å®ç°

ä¿®æ”¹ `MyBookings.vue` ä¸­çš„ `handleViewAuditDetail` æ–¹æ³•ï¼š

```javascript
import { getApprovalHistory } from '@/api/roomBookingManagement'

async function handleViewAuditDetail(row) {
  try {
    const response = await getApprovalHistory(row.id)
    if (response.code === 200) {
      // è½¬æ¢æ•°æ®æ ¼å¼ä»¥é€‚é…å¼¹å‡ºæ¡†ç»„ä»¶
      const approvalSteps = response.data.map(item => ({
        levelName: item.levelName,
        approvers: item.approvers,
        confirmedApprover: item.confirmedApprover,
        approvalTime: item.approvalTime ? 
          new Date(item.approvalTime).toLocaleString('zh-CN') : '/',
        comment: item.approvalComment || '/'
      }))

      currentRecord.value = {
        reservationTitle: row.reservationName,
        userName: row.applicantName,
        borrowPeriodText: row.reservationPeriod,
        borrowDesc: row.description,
        participants: [], // å¯ä»å…¶ä»–æ¥å£è·å–
        remark: '', // å¯ä»å…¶ä»–æ¥å£è·å–
        approvalStatus: row.approvalStatus,
        approvalSteps: approvalSteps
      }
      auditDialogVisible.value = true
    } else {
      ElMessage.error('è·å–å®¡æ‰¹å†å²å¤±è´¥ï¼š' + response.message)
    }
  } catch (error) {
    console.error('è·å–å®¡æ‰¹å†å²å¤±è´¥ï¼š', error)
    ElMessage.error('è·å–å®¡æ‰¹å†å²å¤±è´¥')
  }
}
```

## ğŸš€ å®ç°ä¼˜åŠ¿

1. **æ•°æ®å‡†ç¡®æ€§**: ä½¿ç”¨çœŸå®çš„åç«¯æ•°æ®æ›¿ä»£æ¨¡æ‹Ÿæ•°æ®
2. **å®æ—¶æ€§**: æ˜¾ç¤ºæœ€æ–°çš„å®¡æ‰¹çŠ¶æ€å’Œå†å²è®°å½•
3. **æƒé™æ§åˆ¶**: åç«¯éªŒè¯ç”¨æˆ·æƒé™ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
4. **æ•°æ®å®Œæ•´æ€§**: åŒ…å«å®Œæ•´çš„å®¡æ‰¹æµç¨‹ä¿¡æ¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™éªŒè¯**: æ¥å£ä¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æŸ¥çœ‹è¯¥é¢„çº¦çš„å®¡æ‰¹å†å²
2. **æ•°æ®æ ¼å¼**: å‰ç«¯éœ€è¦å°†åç«¯è¿”å›çš„æ—¶é—´æ ¼å¼è½¬æ¢ä¸ºæœ¬åœ°æ˜¾ç¤ºæ ¼å¼
3. **é”™è¯¯å¤„ç†**: éœ€è¦å¤„ç†æ¥å£è°ƒç”¨å¤±è´¥çš„æƒ…å†µ
4. **åŠ è½½çŠ¶æ€**: å»ºè®®æ·»åŠ åŠ è½½çŠ¶æ€æç¤ºç”¨æˆ·æ•°æ®æ­£åœ¨è·å–ä¸­

## ğŸ“‹ å®æ–½æ­¥éª¤

1. âœ… **æ¥å£å·²å­˜åœ¨**: åç«¯å®¡æ‰¹å†å²æ¥å£å·²ç»å®ç°
2. â³ **å‰ç«¯é›†æˆ**: éœ€è¦åœ¨å‰ç«¯è°ƒç”¨çœŸå®æ¥å£æ›¿ä»£æ¨¡æ‹Ÿæ•°æ®
3. â³ **æµ‹è¯•éªŒè¯**: éªŒè¯æ•°æ®æ˜¾ç¤ºæ­£ç¡®æ€§å’Œç”¨æˆ·ä½“éªŒ
4. â³ **é”™è¯¯å¤„ç†**: å®Œå–„å¼‚å¸¸æƒ…å†µçš„å¤„ç†é€»è¾‘

---

## ğŸ’¡ æ€»ç»“

é¡¹ç›®ä¸­å·²ç»å­˜åœ¨å®Œæ•´çš„å®¡æ‰¹å†å²æŸ¥è¯¢æ¥å£ï¼Œåªéœ€è¦åœ¨å‰ç«¯çš„ `handleViewAuditDetail` æ–¹æ³•ä¸­è°ƒç”¨ `/api/room-booking/approval-history/{bookingId}` æ¥å£ï¼Œå°†è¿”å›çš„æ•°æ®æ ¼å¼åŒ–åä¼ é€’ç»™å®¡æ ¸è¯¦æƒ…å¼¹å‡ºæ¡†ç»„ä»¶å³å¯å®ç°åŠŸèƒ½ã€‚