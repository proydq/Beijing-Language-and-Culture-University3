# 前端接口修复说明

## 一、修复内容概述

### 1. 统一 API 路径管理
- 创建了 `src/api/apiConfig.js` 文件，集中管理所有 API 路径
- 根据后端实际的 `@RequestMapping` 路径进行映射
- 区分了带 `/api` 前缀和不带前缀的路径

### 2. 统一 Axios 实例
- 统一使用 `request` 实例（来自 `@/utils/request.js`）
- 移除了对 `api` 实例的依赖
- 确保所有请求都经过统一的拦截器处理

### 3. 修复的 API 文件
已修复以下 API 文件的路径问题：
- `blacklist.js` - 黑名单管理
- `violationSettings.js` - 违规设置
- `area.js` - 区域管理
- `auth.js` - 认证相关
- `continuousBooking.js` - 连续预约设置
- `bookingPersonnelPermission.js` - 预约人员权限
- `booking.js` - 预约限制和时间规则

## 二、API 路径映射表

### 带 /api 前缀的接口
| 模块 | 前端路径常量 | 后端映射 |
|------|-------------|---------|
| 房间管理 | API_PATHS.ROOM | /api/room |
| 房间预约 | API_PATHS.ROOM_BOOKING | /api/room-booking |
| 房间计划 | API_PATHS.ROOM_SCHEDULE | /api/room-schedule |
| 用户管理 | API_PATHS.USER | /api/user |
| 组织管理 | API_PATHS.ORGANIZATION | /api/organization |
| 职位管理 | API_PATHS.POSITION | /api/position |
| 职称管理 | API_PATHS.TITLE | /api/title |
| 文件上传 | API_PATHS.UPLOAD | /api/upload |

### 不带 /api 前缀的接口
| 模块 | 前端路径常量 | 后端映射 |
|------|-------------|---------|
| 认证 | API_PATHS.AUTHENTICATION | /authentication |
| 黑名单 | API_PATHS.BLACKLIST | /blacklist |
| 违规设置 | API_PATHS.VIOLATION_SETTINGS | /violation-settings |
| 区域 | API_PATHS.AREA | /area |
| 预约权限 | API_PATHS.BOOKING_PERSONNEL_PERMISSION | /booking-personnel-permission |
| 连续预约 | API_PATHS.CONTINUOUS_BOOKING_SETTINGS | /continuous-booking-settings |
| 预约限制 | API_PATHS.USER_BOOKING_LIMITS | /user-booking-limits |
| 时间规则 | API_PATHS.BOOKING_TIME_RULES | /booking-time-rules |
| 预约验证 | API_PATHS.BOOKING_VALIDATION | /booking-validation |

## 三、使用示例

### 1. 导入方式
```javascript
import { request, API_PATHS } from './apiConfig'
```

### 2. 使用路径常量
```javascript
// 之前
return request.post('/blacklist/search', condition)

// 现在
return request.post(`${API_PATHS.BLACKLIST}/search`, condition)
```

### 3. 完整示例
```javascript
// 获取黑名单列表
export const searchBlacklist = (condition) => {
  return request.post(`${API_PATHS.BLACKLIST}/search`, condition)
}

// 删除黑名单记录
export const removeFromBlacklist = (blacklistId) => {
  return request.delete(`${API_PATHS.BLACKLIST}/${blacklistId}`)
}
```

## 四、注意事项

1. **重启开发服务器**
   - 修改后需要重启 `npm run dev`
   - 确保代理配置生效

2. **清除浏览器缓存**
   - 建议清除缓存或使用无痕模式测试
   - 避免旧的请求被缓存

3. **检查网络请求**
   - 打开浏览器开发者工具
   - 在 Network 面板查看请求路径是否正确
   - 请求应该是相对路径（如 `/blacklist/search`）

4. **错误处理**
   - 所有错误已经被响应拦截器统一处理
   - 成功响应的 code 会被转换为 200
   - 业务错误会被 Promise.reject 抛出

## 五、待修复的 API 文件

如果还有其他 API 文件需要修复，请按照以下步骤：

1. 导入 `apiConfig.js`
2. 将 `import api from './index'` 改为 `import { request, API_PATHS } from './apiConfig'`
3. 将 `api.` 改为 `request.`
4. 使用 `API_PATHS` 中定义的路径常量

## 六、测试建议

1. **登录功能**
   - 测试路径：`/authentication/login`
   - 验证 Token 是否正确保存

2. **黑名单管理**
   - 测试搜索、添加、删除功能
   - 验证路径：`/blacklist/*`

3. **区域管理**
   - 测试区域树加载
   - 验证路径：`/area/*`

4. **预约权限**
   - 测试权限列表查询
   - 验证路径：`/booking-personnel-permission/*`