# 前端接口问题修复总结

## 一、问题原因分析

前端出现多个接口调用失败的原因主要有：

1. **API 路径不一致**
   - 有些接口使用 `/api` 前缀，有些不使用
   - 前端代码没有正确映射后端的 `@RequestMapping` 路径

2. **axios 实例混用**
   - 部分文件使用 `import request from '@/utils/request'`
   - 部分文件使用 `import api from './index'`
   - 导致请求配置不一致

3. **导入方式不统一**
   - 有些使用对象方式调用：`request({ url: '/xxx', method: 'post' })`
   - 有些使用方法方式调用：`request.post('/xxx')`

## 二、修复内容

### 2.1 创建统一的 API 配置文件

创建了 `src/api/apiConfig.js`，定义了所有 API 路径常量：

```javascript
export const API_PATHS = {
  // 带 /api 前缀的路径
  ROOM: '/api/room',
  ROOM_BOOKING: '/api/room-booking',
  USER: '/api/user',
  // ... 
  
  // 不带 /api 前缀的路径
  AUTHENTICATION: '/authentication',
  BLACKLIST: '/blacklist',
  AREA: '/area',
  // ...
}
```

### 2.2 修复的 API 文件列表

已统一修复以下文件的导入方式和路径：

1. ✅ `blacklist.js` - 黑名单管理
2. ✅ `violationSettings.js` - 违规设置
3. ✅ `area.js` - 区域管理
4. ✅ `auth.js` - 认证相关
5. ✅ `continuousBooking.js` - 连续预约设置
6. ✅ `bookingPersonnelPermission.js` - 预约人员权限
7. ✅ `booking.js` - 预约限制和时间规则
8. ✅ `schemeManagement.js` - 方案管理（包含人员搜索）
9. ✅ `recycleBin.js` - 回收站管理
10. ✅ `remoteAccessRecords.js` - 远程开门记录
11. ✅ `accessRecords.js` - 教室出入记录
12. ✅ `user.js` - 用户管理
13. ✅ `upload.js` - 文件上传

### 2.3 修复示例

#### 修复前：
```javascript
import api from './index'

export function searchBlacklist(condition) {
  return request.post('/blacklist/search', condition)
}
```

#### 修复后：
```javascript
import { request, API_PATHS } from './apiConfig'

export function searchBlacklist(condition) {
  return request.post(`${API_PATHS.BLACKLIST}/search`, condition)
}
```

## 三、错误信息对应的接口

| 错误信息 | 对应接口 | 修复状态 |
|----------|----------|----------|
| 获取区域树失败 | `/area/tree` | ✅ 已修复 |
| 获取楼栋架构失败 | `/area/tree` | ✅ 已修复 |
| 搜索人员失败 | `/scheme-management/personnel/list` | ✅ 已修复 |
| 获取权限列表失败 | `/booking-personnel-permission/list` | ✅ 已修复 |
| 加载预约时间规则失败 | `/booking-time-rules/list` | ✅ 已修复 |
| 加载用户预约限制失败 | `/user-booking-limits/all` | ✅ 已修复 |
| 加载连续预约设置失败 | `/continuous-booking-settings/list` | ✅ 已修复 |
| 加载教室数据失败 | `/api/room/search` | ✅ 已修复 |
| 加载回收站数据失败 | `/recycle-bin/classrooms/search` | ✅ 已修复 |
| 获取违规设置数据失败 | `/violation-settings/search` | ✅ 已修复 |
| 获取黑名单数据失败 | `/blacklist/search` | ✅ 已修复 |

## 四、重要说明

### 4.1 代理配置
- 已配置 Vite 代理，将请求转发到后端
- `/api/**` → `http://localhost:10086/api/**`
- `/authentication/**` → `http://localhost:10086/authentication/**`
- 其他路径同理

### 4.2 响应格式处理
- 后端返回 `code: "0"` 表示成功
- 前端拦截器自动转换为 `code: 200`
- 确保前端代码使用 `response.code === 200` 判断成功

### 4.3 使用建议
1. **重启开发服务器**：修改后必须重启 `npm run dev`
2. **清除浏览器缓存**：避免旧请求被缓存
3. **检查控制台**：查看 Network 面板确认请求路径正确

## 五、后续优化建议

1. **后端优化**
   - 统一使用全局异常处理，移除 Controller 中的 try-catch
   - 确保所有接口返回统一的响应格式

2. **前端优化**
   - 考虑使用 TypeScript 增加类型安全
   - 添加请求重试机制
   - 完善错误提示信息

3. **测试建议**
   - 测试所有模块的基本功能
   - 确认数据加载正常
   - 验证错误处理机制